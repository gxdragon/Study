<!DOCTYPE html>
<html>
	<head>
		<meta charset="EUC-KR">
		<title>Learning Node.js & Three.js</title>
		<link rel="stylesheet" type="text/css" href="../public/css/index.css">
		<script src="/public/js/jquery/jquery-3.1.1.min.js"></script>
		<script src="/public/js/three/three.js"></script>
        <script src="/public/js/three/libs/stats.min.js"></script>
	</head>
	<body>
		<script>
			var _scene = new THREE.Scene();
			var _camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
			var _renderer = new THREE.WebGLRenderer();

			var _stats;
			var _oldPlane, _newPlane, _sphere;

        	var _planeSpeed = 1;
			var _speed = 0.1;
			var _planeGeom = new THREE.PlaneGeometry(150, 20, 1, 1);
			var _planeMaterial = new THREE.MeshBasicMaterial({color:0xcccccc, wireframe:true});
			
            init();
            render(); 
			function init(){
				_renderer.setClearColor(0xEEEEEE);
				_renderer.setSize(window.innerWidth, window.innerHeight);
				
				var axes = new THREE.AxesHelper(20);
				_scene.add(axes);
				
				var light = new THREE.SpotLight(0xffffff);
				light.position.set(-40, 60, -10);
				_scene.add(light);
				
				
				_oldPlane = new THREE.Mesh(_planeGeom, _planeMaterial);
				_oldPlane.rotation.x = -0.5 * Math.PI;
				_oldPlane.position.x = 30;
				_oldPlane.position.y = 0;
				_oldPlane.position.z = 0;
				_scene.add(_oldPlane);
				
				var geom = new THREE.SphereGeometry(4, 20, 20);
				var material = new THREE.MeshBasicMaterial({color:0xffffff, wireframe:true});
				_sphere = new THREE.Mesh(geom, material);
				_sphere.position.x = 0;
				_sphere.position.y = 4;
				_sphere.position.z = 0;
				_scene.add(_sphere);
				
				_camera.position.x = -30;
				_camera.position.y = 40;
				_camera.position.z = 30;
				_camera.lookAt(_scene.position);
				
				document.body.appendChild(_renderer.domElement);
                _stats = new Stats();
                _stats.domElement.style.position = 'absolute';
                _stats.domElement.style.top = '0px';
                _stats.domElement.style.zIndex = 100;
                document.body.appendChild(_stats.domElement);
			}
        	function render(){
                requestAnimationFrame( render );
                move(null);
                _stats.update();
                _renderer.render( _scene, _camera );
        	}
        	
        	function move(event){
        		_sphere.rotation.z -= _speed;
				_oldPlane.position.x -= _planeSpeed;
				if(_newPlane){
					_newPlane.position.x -= _planeSpeed;
					if(_newPlane.position.x==23){
						_scene.remove(_oldPlane);
						_oldPlane = new THREE.Mesh(_planeGeom, _planeMaterial);
						_oldPlane.rotation.x = -0.5 * Math.PI;
						_oldPlane.position.x = 173;
						_oldPlane.position.y = 0;
						_oldPlane.position.z = 0;
						_scene.add(_oldPlane);
					}
				}
				if(_oldPlane.position.x==23){
					if(_newPlane){
						_scene.remove(_newPlane);
					}
					_newPlane = new THREE.Mesh(_planeGeom, _planeMaterial);
					_newPlane.rotation.x = -0.5 * Math.PI;
					_newPlane.position.x = 173;
					_newPlane.position.y = 0;
					_newPlane.position.z = 0;
					_scene.add(_newPlane);
				} 
			}
		</script>
	</body>
</html>